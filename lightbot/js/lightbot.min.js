var lightBot={};(function(){lightBot.directions={se:0,ne:1,nw:2,sw:3}})();(function(){lightBot.bot={startingPos:{x:0,y:0},currentPos:{x:0,y:0},startingDirection:lightBot.directions.se,direction:lightBot.directions.se,instructionQueue:[],executionQueue:[],executionMode:false,init:function(a,b){this.startingPos=$.extend({},b);this.currentPos=b;this.direction=this.startingDirection=a;this.reset()},reset:function(){this.currentPos=$.extend({},this.startingPos);this.direction=this.startingDirection;this.instructionQueue.length=0;this.executionQueue.length=0;this.executionMode=
false},clearExecutionQueue:function(){this.executionQueue.length=0},queueInstruction:function(a){this.instructionQueue.push(a)},queueInstructions:function(a){this.instructionQueue=this.instructionQueue.concat(a)},hasNextInstruction:function(){return this.executionQueue.length>0},execute:function(){this.executionMode=true;this.executionQueue=this.instructionQueue.slice()},executeNextInstruction:function(){if(this.executionQueue.length>0){var a=this.executionQueue.shift();switch(a.name){case lightBot.bot.instructions.WalkInstruction.instructionName:this.walk();
break;case lightBot.bot.instructions.JumpInstruction.instructionName:this.jump();break;case lightBot.bot.instructions.LightInstruction.instructionName:this.light();break;case lightBot.bot.instructions.TurnLeftInstruction.instructionName:this.turnLeft();break;case lightBot.bot.instructions.TurnRightInstruction.instructionName:this.turnRight();break;case lightBot.bot.instructions.RepeatInstruction.instructionName:a.counter>1&&(a.counter--,this.executionQueue.unshift(a));for(var b=a.body.length-1;b>=
0;b--)this.executionQueue.unshift($.extend(true,{},a.body[b]));return this.executeNextInstruction();default:console.error('Bot executeNextInstruction: unknown instruction "'+a.name+'"')}return a}else return console.error("Bot executeNextInstruction: no instruction to execute"),null},walk:function(){switch(this.direction){case lightBot.directions.se:this.currentPos.y>0&&lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].height===lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y-
1].height&&this.currentPos.y--;break;case lightBot.directions.ne:this.currentPos.x+1<lightBot.map.getLevelSize().x&&lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].height===lightBot.map.getMapRef()[this.currentPos.x+1][this.currentPos.y].height&&this.currentPos.x++;break;case lightBot.directions.nw:this.currentPos.y+1<lightBot.map.getLevelSize().y&&lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].height===lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y+1].height&&
this.currentPos.y++;break;case lightBot.directions.sw:this.currentPos.x>0&&lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].height===lightBot.map.getMapRef()[this.currentPos.x-1][this.currentPos.y].height&&this.currentPos.x--;break;default:console.error('Bot walk: unknown direction "'+this.direction+'"')}},jump:function(){switch(this.direction){case lightBot.directions.se:this.currentPos.y>0&&(lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y-1].height-lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].height===
1||lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].height>lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y-1].height)&&this.currentPos.y--;break;case lightBot.directions.ne:this.currentPos.x+1<lightBot.map.getLevelSize().x&&(lightBot.map.getMapRef()[this.currentPos.x+1][this.currentPos.y].height-lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].height===1||lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].height>lightBot.map.getMapRef()[this.currentPos.x+
1][this.currentPos.y].height)&&this.currentPos.x++;break;case lightBot.directions.nw:this.currentPos.y+1<lightBot.map.getLevelSize().y&&(lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y+1].height-lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].height===1||lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].height>lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y+1].height)&&this.currentPos.y++;break;case lightBot.directions.sw:this.currentPos.x>0&&
lightBot.map.getLevelSize().x&&(lightBot.map.getMapRef()[this.currentPos.x-1][this.currentPos.y].height-lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].height===1||lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].height>lightBot.map.getMapRef()[this.currentPos.x-1][this.currentPos.y].height)&&this.currentPos.x--;break;default:console.error("Bot is facing unknown direction")}},light:function(){var a=lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y];a instanceof
lightBot.LightBox&&a.toggleLight()},turnLeft:function(){this.direction=(this.direction+1)%4},turnRight:function(){this.direction--;if(this.direction<0)this.direction=3},isInExecutionMode:function(){return this.executionMode},getNumberOfInstructions:function(){function a(b){for(var d=0,c=0;c<b.length;c++)d++,b[c]instanceof lightBot.bot.instructions.RepeatInstruction&&(d+=a(b[c].body));return d}return a(this.instructionQueue)}}})();(function(){function a(b){this.name=b}var b={WalkInstruction:function(){}};b.WalkInstruction.instructionName="walk";b.WalkInstruction.prototype=new a(b.WalkInstruction.instructionName);b.WalkInstruction.prototype.constructor=b.WalkInstruction;b.JumpInstruction=function(){};b.JumpInstruction.instructionName="jump";b.JumpInstruction.prototype=new a(b.JumpInstruction.instructionName);b.JumpInstruction.prototype.constructor=b.JumpInstruction;b.LightInstruction=function(){};b.LightInstruction.instructionName=
"light";b.LightInstruction.prototype=new a(b.LightInstruction.instructionName);b.LightInstruction.prototype.constructor=b.LightInstruction;b.TurnLeftInstruction=function(){};b.TurnLeftInstruction.instructionName="turnLeft";b.TurnLeftInstruction.prototype=new a(b.TurnLeftInstruction.instructionName);b.TurnLeftInstruction.prototype.constructor=b.TurnLeftInstruction;b.TurnRightInstruction=function(){};b.TurnRightInstruction.instructionName="turnRight";b.TurnRightInstruction.prototype=new a(b.TurnRightInstruction.instructionName);
b.TurnRightInstruction.prototype.constructor=b.TurnRightInstruction;b.RepeatInstruction=function(b,a){this.counter=b;this.body=a};b.RepeatInstruction.instructionName="repeat";b.RepeatInstruction.prototype=new a(b.RepeatInstruction.instructionName);b.RepeatInstruction.prototype.constructor=b.RepeatInstruction;b.WhileInstruction=function(b,a){this.condition=b;this.body=a};b.WhileInstruction.instructionName="while";b.WhileInstruction.prototype=new a(b.WhileInstruction.instructionName);b.WhileInstruction.prototype.constructor=
b.WhileInstruction;lightBot.bot.instructions=b})();(function(){var a={},b=null,d={x:0,y:0},c=null,g=null,j=null;a.loadMaps=function(){$.getJSON("maps/maps.txt",function(a){b=a})};a.loadMap=function(a){if(b){j=a;lightBot.bot.init(b[a].direction,b[a].position);g=b[a].medals;d.x=b[a].map[0].length;d.y=b[a].map.length;c=Array(d.x);for(h=0;h<d.x;h++)c[h]=Array(d.y);for(var i=0,h=0;h<b[a].map.length;h++)for(var f=0;f<b[a].map[h].length;f++)switch(b[a].map[h][f].t){case "b":c[f][b[a].map.length-h-1]=new lightBot.Box(b[a].map[h][f].h,f,b[a].map.length-h-
1);break;case "l":c[f][b[a].map.length-h-1]=new lightBot.LightBox(b[a].map[h][f].h,f,b[a].map.length-h-1);i++;break;default:console.error("Map contains unsupported element: "+b[a].map[h][f].t),c[f][b.map.length-h-1]=new lightBot.Box(b[a].map[h][f].h,f,b[a].map.length-h-1)}i===0&&console.error("No light defined in map")}else console.error("Map list is empty")};a.reset=function(){lightBot.bot.reset();for(var a=0;a<d.x;a++)for(var b=0;b<d.y;b++)c[a][b].reset()};a.ready=function(){return j!==null};a.getLevelSize=
function(){return d};a.getMapRef=function(){return c};a.getMedals=function(){return g};a.getLevelNumber=function(){return j};a.getNbrOfLevels=function(){return b.length};a.complete=function(){j=null};lightBot.map=a})();(function(){lightBot.map.state={allLightsOn:function(){for(var a=0;a<lightBot.map.getLevelSize().x;a++)for(var b=0;b<lightBot.map.getLevelSize().y;b++)if(lightBot.map.getMapRef()[a][b]instanceof lightBot.LightBox&&!lightBot.map.getMapRef()[a][b].lightOn)return false;return true},check:function(a){return a()}}})();(function(){lightBot.Box=function(a,b,d){this.height=a;this.x=b;this.y=d;this.reset=function(){}}})();(function(){function a(a,d,c){this.lightOn=false;this.height=a;this.x=d;this.y=c;this.toggleLight=function(){this.lightOn=!this.lightOn};this.reset=function(){this.lightOn=false}}a.prototype=new lightBot.Box;a.prototype.constructor=a;lightBot.LightBox=a})();(function(){lightBot.medals={gold:4,silver:3,bronze:2,noMedal:1,awardMedal:function(){var a=lightBot.bot.getNumberOfInstructions(),b=lightBot.map.getMedals(),d=this.noMedal;if(a<=b.gold)d=this.gold;else if(a<=b.silver)d=this.silver;else if(a<=b.bronze)d=this.bronze;(!localStorage.getItem("lightbot_level_"+lightBot.map.getLevelNumber())||parseInt(localStorage.getItem("lightbot_level_"+lightBot.map.getLevelNumber()),10)<d)&&localStorage.setItem("lightbot_level_"+lightBot.map.getLevelNumber(),d);return d}}})();(function(){function a(){for(var a=0,b=0;b<lightBot.map.getNbrOfLevels();b++)localStorage.getItem("lightbot_level_"+b)&&a++;return a}function b(a){for(var b=0,g=0;g<lightBot.map.getNbrOfLevels();g++)localStorage.getItem("lightbot_level_"+g)&&parseInt(localStorage.getItem("lightbot_level_"+g),10)>=a&&b++;return b}lightBot.achievements={achievementsList:[{name:"lightbot_achievement_complete_level",title:"Finiquitado",message:"Completa un nivel.",check:function(){return true}},{name:"lightbot_achievement_earn_gold_medal",
title:"Niño de mamá",message:"Gana una medalla de oro.",check:function(){return lightBot.bot.getNumberOfInstructions()<=lightBot.map.getMedals().gold?true:false}},{name:"lightbot_achievement_complete_levels_5",title:"Ambicioso",message:"Completa 5 niveles.",check:function(){return a()>=5?true:false}},{name:"lightbot_achievement_complete_levels_10",title:"Dedicado",message:"Completa 10 niveles.",check:function(){return a()>=10?true:false}},{name:"lightbot_achievement_complete_levels_15",title:"Adicto",message:"Completa 15 niveles.",
check:function(){return a()>=15?true:false}},{name:"lightbot_achievement_complete_levels_bronze",title:"Nerd",message:"Logra medalla de bronce en todos los niveles.",check:function(){return b(lightBot.medals.bronze)===lightBot.map.getNbrOfLevels()}},{name:"lightbot_achievement_complete_levels_silver",title:"Elite",message:"Logra medalla de plata en todos los niveles.",check:function(){return b(lightBot.medals.silver)===lightBot.map.getNbrOfLevels()}},{name:"lightbot_achievement_complete_levels_gold",title:"H4X0R",message:"Logra oro en todos los niveles.",
check:function(){return b(lightBot.medals.gold)===lightBot.map.getNbrOfLevels()}}],hasAchievement:function(a){return localStorage.getItem(a)},awardAchievements:function(){for(var a=[],b=0;b<this.achievementsList.length;b++)!this.hasAchievement(this.achievementsList[b].name)&&this.achievementsList[b].check()&&(localStorage.setItem(this.achievementsList[b].name,true),a.push(this.achievementsList[b]));return a},getAchievementsList:function(){return this.achievementsList}}})();(function(){lightBot.ui={showWelcomeScreen:function(a){lightBot.ui.media.playMenuAudio();a==null&&lightBot.ui.History&&lightBot.ui.History.pushState({page:"welcomeScreen"});$("title").text("Lightbot - Welcome");$(".ui-screen").hide();$("#welcomeScreen").show()},showHelpScreen:function(a){lightBot.ui.media.playMenuAudio();a==null&&lightBot.ui.History&&lightBot.ui.History.pushState({page:"helpScreen"});$("title").text("Lightbot - Help");$(".ui-screen").hide();$("#helpScreen").show()},showAchievementsScreen:function(a){lightBot.ui.media.playMenuAudio();
var b=false;$("#achievementsList").empty();for(var d=lightBot.achievements.getAchievementsList(),c=0;c<d.length;c++)b=lightBot.achievements.hasAchievement(d[c].name)?true:false,$('<li class="'+(b?"":"ui-state-disabled")+'"><img src="img/achievements/'+d[c].name+'.png"><h3>'+d[c].title+"</h3><p>"+d[c].message+"</p></li>").appendTo("#achievementsList");a==null&&lightBot.ui.History&&lightBot.ui.History.pushState({page:"achievementsScreen"});$("title").text("Lightbot - Achievements");$(".ui-screen").hide();
$("#achievementsScreen").show()},showLevelSelectScreen:function(a){lightBot.ui.media.playMenuAudio();$("#levelList").empty();for(var b=0;b<lightBot.map.getNbrOfLevels();b++){var d=parseInt(localStorage.getItem("lightbot_level_"+b),10),c="";if(d){switch(d){case lightBot.medals.gold:c="medal-gold";break;case lightBot.medals.silver:c="medal-silver";break;case lightBot.medals.bronze:c="medal-bronze";break;case lightBot.medals.noMedal:break;default:console.error('Unknown medal "'+c+'"')}$('<li class="ui-state-highlight"><span class="medal '+
c+'" style="position: absolute; bottom: 2px; right: 0px"></span><span>'+b+"</span></li>").appendTo("#levelList")}else $("<li>"+b+"</li>").appendTo("#levelList")}a==null&&lightBot.ui.History&&lightBot.ui.History.pushState({page:"levelSelectScreen"});$("title").text("Lightbot - Level Select");$(".ui-screen").hide();$("#levelSelectScreen").show()},showGameScreen:function(a,b){lightBot.ui.media.playGameAudio();lightBot.map.loadMap(a);b==null&&lightBot.ui.History&&lightBot.ui.History.pushState({page:"gameScreen",
level:a});$("title").text("Lightbot - Level "+a);$(".ui-screen").hide();$("#programContainer li").remove();localStorage.getItem("lightbot_program_level_"+a)?lightBot.ui.editor.loadProgram():$("#programContainer ul").append('<li class="ui-state-default placeholder"><p class="placeholder">Arrastrá tus instrucciones aquí</p></li>');$("#runButton").button("option",{label:"Run",icons:{primary:"ui-icon-play"}}).removeClass("ui-state-highlight");$("#gameScreen").show()}}})();$(document).ready(function(){$("#audioPlayer").jPlayer({ready:function(){$(this).jPlayer("setMedia",lightBot.ui.media.audio.menu).jPlayer("play")},swfPath:"js",supplied:"mp3",loop:true,solution:"flash, html",cssSelectorAncestor:"#audioContainer"});$("#videoPlayer").jPlayer({ready:function(){$(this).jPlayer("setMedia",lightBot.ui.media.video[0])},swfPath:"js",supplied:"webmv, ogv, m4v",preload:"metadata",cssSelectorAncestor:"#videoContainer",backgroundColor:"#000000",size:{width:"400px",height:"300px",
cssClass:"jp-video-300p"}});lightBot.ui.media.audioPlayer=$("#audioPlayer");lightBot.ui.media.videoPlayer=$("#videoPlayer")});
(function(){lightBot.ui.media={audioPlayer:null,videoPlayer:null,audio:{menu:{mp3:"media/audio/menu.mp3"},game:{mp3:"media/audio/game.mp3"}},video:[{webmv:"media/video/goal.webm",m4v:"media/video/goal.mp4",ogv:"media/video/goal.ogv"},{webmv:"media/video/howto.webm",m4v:"media/video/howto.mp4",ogv:"media/video/howto.ogv"},{webmv:"media/video/objects.webm",m4v:"media/video/objects.mp4",ogv:"media/video/objects.ogv"},{webmv:"media/video/walk.webm",m4v:"media/video/walk.mp4",ogv:"media/video/walk.ogv"},
{webmv:"media/video/turnRight.webm",m4v:"media/video/turnRight.mp4",ogv:"media/video/turnRight.ogv"},{webmv:"media/video/turnLeft.webm",m4v:"media/video/turnLeft.mp4",ogv:"media/video/turnLeft.ogv"},{webmv:"media/video/jump.webm",m4v:"media/video/jump.mp4",ogv:"media/video/jump.ogv"},{webmv:"media/video/light.webm",m4v:"media/video/light.mp4",ogv:"media/video/light.ogv"},{webmv:"media/video/repeat.webm",m4v:"media/video/repeat.mp4",ogv:"media/video/repeat.ogv"},{webmv:"media/video/medal.webm",m4v:"media/video/medal.mp4",
ogv:"media/video/medal.ogv"}],audioEnabled:true,playMenuAudio:function(){this.audioPlayer.data("jPlayer").status.media.mp3!=this.audio.menu.mp3&&(this.audioPlayer.jPlayer("setMedia",this.audio.menu),this.audioEnabled&&this.audioPlayer.jPlayer("play"))},playGameAudio:function(){this.audioPlayer.data("jPlayer").status.media.mp3!=this.audio.game.mp3&&(this.audioPlayer.jPlayer("setMedia",this.audio.game),this.audioEnabled&&this.audioPlayer.jPlayer("play"))},playVideo:function(a){this.videoPlayer.jPlayer("setMedia",
this.video[a])},toggleAudioOn:function(){this.audioEnabled=true;this.audioPlayer.jPlayer("play");$(".audioToggleButton").children("span.ui-button-icon-primary").addClass("ui-icon-volume-on").removeClass("ui-icon-volume-off")},toggleAudioOff:function(){this.audioEnabled=false;this.audioPlayer.jPlayer("pause");$(".audioToggleButton").children("span.ui-button-icon-primary").addClass("ui-icon-volume-off").removeClass("ui-icon-volume-on")},toggleAudio:function(){this.audioEnabled?this.toggleAudioOff():
this.toggleAudioOn()}}})();$(document).ready(function(){$(".helpButton").button({icons:{primary:"ui-icon-help"}}).click(function(){lightBot.ui.showHelpScreen()});$(".mainMenuButton").button({icons:{primary:"ui-icon-home"}}).click(function(){lightBot.ui.showWelcomeScreen()});$(".achievementsButton").button({icons:{primary:"ui-icon-flag"}}).click(function(){lightBot.ui.showAchievementsScreen()});$(".levelSelectButton").button({icons:{primary:"ui-icon-power"}}).click(function(){lightBot.ui.showLevelSelectScreen()});$("#gameScreen .levelSelectButton").button("option",
{icons:{primary:"ui-icon-home"}});$("#levelList li").live({mouseover:function(){$(this).addClass("ui-state-hover")},mouseout:function(){$(this).removeClass("ui-state-hover")},click:function(){lightBot.ui.showGameScreen($(this).text())}});$(".audioToggleButton").button({icons:{primary:"ui-icon-volume-on"},text:false}).click(function(){lightBot.ui.media.toggleAudio()});$("#runButton").button({icons:{primary:"ui-icon-play"}}).click(function(){if(lightBot.bot.isInExecutionMode())lightBot.map.reset(),
$(this).button("option",{label:"Run",icons:{primary:"ui-icon-play"}}).removeClass("ui-state-highlight");else{var a=lightBot.ui.editor.getInstructions($("#programContainer > div > ul > li"));lightBot.bot.queueInstructions(a);lightBot.bot.execute();$(this).button("option",{label:"Stop",icons:{primary:"ui-icon-stop"}}).addClass("ui-state-highlight")}});$("#clearButton").button({icons:{primary:"ui-icon-document"}}).click(function(){$("#programContainer ul").empty();lightBot.ui.editor.saveProgram()});
$("#helpScreenAccordion").accordion({autoHeight:false,navigation:true,icons:false,change:function(a,b){lightBot.ui.media.playVideo($("#helpScreenAccordion h3").index(b.newHeader))}})});$(document).ready(function(){$("div#levelCompleteDialog").dialog({draggable:false,autoOpen:false,modal:true,width:400,height:200,stack:false,resizable:false,close:function(){lightBot.ui.showLevelSelectScreen()},buttons:{Ok:function(){$(this).dialog("close")}}});$("div#achievementDialog").dialog({draggable:false,autoOpen:false,modal:true,width:400,height:200,stack:true,resizable:false,close:function(){lightBot.achievements.display()},buttons:{Ok:function(){$(this).dialog("close")}}})});$(document).ready(function(){$("#programContainer").delegate(':input[type="number"]',"change",function(){lightBot.ui.editor.saveProgram()});$("#programContainer").delegate(".ui-icon-close","click",function(){$(this).parent().parent().remove();lightBot.ui.editor.saveProgram()});$("#instructionsContainer li").draggable({revert:"invalid",appendTo:"body",helper:"clone",cursor:"move"}).addClass("ui-state-default");$("#instructionsContainer, #programContainer").delegate("li","hover",function(){$(this).toggleClass("ui-state-hover")});
lightBot.ui.editor.makeDroppable()});
(function(){lightBot.ui.editor={saveProgram:function(){$("#programContainer ul").find(':input[type="number"]').each(function(){$(this).attr("value",$(this).val())});localStorage.setItem("lightbot_program_level_"+lightBot.map.getLevelNumber(),$("#programContainer ul").html())},loadProgram:function(){$("#programContainer ul").append(localStorage.getItem("lightbot_program_level_"+lightBot.map.getLevelNumber())).find("*").removeClass("ui-state-hover ui-state-droppable");this.makeDroppable()},makeDroppable:function(){$("#programContainer ul").droppable({greedy:"true",
activeClass:"ui-state-droppable",hoverClass:"ui-state-droppable-hover",accept:":not(.ui-sortable-helper)",drop:function(a,b){$(this).children(".placeholder").remove();var d=$(b.draggable.clone()).removeClass("ui-draggable");d.appendTo(this);d.children("div").hasClass("droppable")&&lightBot.ui.editor.makeDroppable();d=$(this).parent();d.parent().is("#programContainer")&&d.animate({scrollTop:d.height()},"slow");lightBot.ui.editor.saveProgram()}}).sortable({items:"li:not(.placeholder)",placeholder:"ui-state-highlight",
cursor:"move",sort:function(){$("#programContainer ul").removeClass("ui-state-droppable")},stop:function(){lightBot.ui.editor.saveProgram()}})},getInstructions:function(a){var b=[];a.each(function(){switch($(this).children("p").attr("class")){case "walk":b.push(new lightBot.bot.instructions.WalkInstruction);break;case "jump":b.push(new lightBot.bot.instructions.JumpInstruction);break;case "light":b.push(new lightBot.bot.instructions.LightInstruction);break;case "turnLeft":b.push(new lightBot.bot.instructions.TurnLeftInstruction);
break;case "turnRight":b.push(new lightBot.bot.instructions.TurnRightInstruction);break;case "repeat":var a=$(this).children("p").children("span").children("input").val(),c=lightBot.ui.editor.getInstructions($(this).children("div").children("div").children("ul").children("li"));b.push(new lightBot.bot.instructions.RepeatInstruction(a,c))}});return b}}})();var canvasView=function(a){lightBot.ctx=a.get(0).getContext("2d");window.setInterval(function(){if(lightBot.bot.isInExecutionMode()&&lightBot.bot.isReadyForNextInstruction()&&lightBot.bot.hasNextInstruction()){var a=$.extend({},lightBot.bot.currentPos),b=lightBot.bot.executeNextInstruction();lightBot.bot.animate(b,a,lightBot.bot.currentPos)}lightBot.map.ready()&&lightBot.map.state.check(lightBot.map.state.allLightsOn)&&(lightBot.bot.clearExecutionQueue(),a=lightBot.medals.awardMedal(),lightBot.medals.display(a),
a=lightBot.achievements.awardAchievements(),lightBot.achievements.display(a),lightBot.map.complete());lightBot.step();lightBot.draw()},1E3/30);lightBot.projection=new lightBot.Projection(a.get(0).height,a.get(0).width/2,50);lightBot.map.loadMaps();var b=null,d=new Image;d.src="img/pattern.png";d.onload=function(){b=lightBot.ctx.createPattern(d,"repeat")};lightBot.step=function(){lightBot.bot.step();lightBot.map.step()};lightBot.draw=function(){lightBot.ctx.clearRect(0,0,a.width(),a.height());lightBot.ctx.fillStyle=
b;lightBot.ctx.fillRect(0,0,a.width(),a.height());switch(lightBot.bot.direction){case lightBot.directions.se:for(var c=lightBot.map.getLevelSize().x-1;c>=0;c--)for(var d=lightBot.map.getLevelSize().y-1;d>=0;d--)lightBot.map.getMapRef()[c][d].draw(),lightBot.bot.currentPos.x===c&&lightBot.bot.currentPos.y===d&&lightBot.bot.draw();break;case lightBot.directions.nw:for(c=lightBot.map.getLevelSize().x-1;c>=0;c--)for(d=lightBot.map.getLevelSize().y-1;d>=0;d--)switch(lightBot.map.getMapRef()[c][d].draw(),
lightBot.bot.getAnimation().name){case lightBot.bot.animations.jumpUp.name:case lightBot.bot.animations.jumpDown.name:lightBot.bot.getMovement().dZ!==0&&lightBot.bot.getCurrentStep()/lightBot.bot.getAnimation().duration<=0.5?lightBot.bot.currentPos.x===c&&lightBot.bot.currentPos.y===d+1&&lightBot.bot.draw():lightBot.bot.currentPos.x===c&&lightBot.bot.currentPos.y===d&&lightBot.bot.draw();break;case lightBot.bot.animations.walk.name:lightBot.bot.getMovement().dZ!==0&&lightBot.bot.currentPos.x===c&&
lightBot.bot.currentPos.y===d+1?lightBot.bot.draw():lightBot.bot.currentPos.x===c&&lightBot.bot.currentPos.y===d&&lightBot.bot.draw();break;default:lightBot.bot.currentPos.x===c&&lightBot.bot.currentPos.y===d&&lightBot.bot.draw()}break;case lightBot.directions.ne:for(c=lightBot.map.getLevelSize().y-1;c>=0;c--)for(d=lightBot.map.getLevelSize().x-1;d>=0;d--)switch(lightBot.map.getMapRef()[d][c].draw(),lightBot.bot.getAnimation().name){case lightBot.bot.animations.jumpUp.name:case lightBot.bot.animations.jumpDown.name:lightBot.bot.getMovement().dX!==
0&&lightBot.bot.getCurrentStep()/lightBot.bot.getAnimation().duration<=0.5?lightBot.bot.currentPos.x===d+1&&lightBot.bot.currentPos.y===c&&lightBot.bot.draw():lightBot.bot.currentPos.x===d&&lightBot.bot.currentPos.y===c&&lightBot.bot.draw();break;case lightBot.bot.animations.walk.name:lightBot.bot.getMovement().dX!==0&&lightBot.bot.currentPos.x===d+1&&lightBot.bot.currentPos.y===c?lightBot.bot.draw():lightBot.bot.currentPos.x===d&&lightBot.bot.currentPos.y===c&&lightBot.bot.draw();break;default:lightBot.bot.currentPos.x===
d&&lightBot.bot.currentPos.y===c&&lightBot.bot.draw()}break;case lightBot.directions.sw:for(c=lightBot.map.getLevelSize().y-1;c>=0;c--)for(d=lightBot.map.getLevelSize().x-1;d>=0;d--)lightBot.map.getMapRef()[d][c].draw(),lightBot.bot.currentPos.x===d&&lightBot.bot.currentPos.y===c&&lightBot.bot.draw();break;default:console.error('canvasView draw: unknown direction "'+lightBot.bot.direction+'"')}};return{}};(function(){lightBot.map.step=function(){for(var a=0;a<lightBot.map.getLevelSize().x;a++)for(var b=0;b<lightBot.map.getLevelSize().y;b++)lightBot.map.getMapRef()[a][b].step()}})();(function(){lightBot.LightBox.prototype.pulseGrowing=true;lightBot.LightBox.prototype.currentAnimationFrame=0;lightBot.Box.prototype.step=function(){};lightBot.Box.prototype.drawTopFace=function(){lightBot.ctx.fillStyle="#c9d3d9";var a=lightBot.projection.project(this.x*50,this.getHeight()*50,this.y*50),b=lightBot.projection.project((this.x+1)*50,this.getHeight()*50,this.y*50),d=lightBot.projection.project((this.x+1)*50,this.getHeight()*50,(this.y+1)*50),c=lightBot.projection.project(this.x*50,this.getHeight()*
50,(this.y+1)*50);lightBot.ctx.beginPath();lightBot.ctx.moveTo(a.x,a.y);lightBot.ctx.lineTo(b.x,b.y);lightBot.ctx.lineTo(d.x,d.y);lightBot.ctx.lineTo(c.x,c.y);lightBot.ctx.lineTo(a.x,a.y);lightBot.ctx.fill();lightBot.ctx.stroke()};lightBot.Box.prototype.drawFrontFace=function(){lightBot.ctx.fillStyle="#adb8bd";var a=lightBot.projection.project(this.x*50,0,this.y*50),b=lightBot.projection.project((this.x+1)*50,0,this.y*50),d=lightBot.projection.project((this.x+1)*50,this.getHeight()*50,this.y*50),
c=lightBot.projection.project(this.x*50,this.getHeight()*50,this.y*50);lightBot.ctx.beginPath();lightBot.ctx.moveTo(a.x,a.y);lightBot.ctx.lineTo(b.x,b.y);lightBot.ctx.lineTo(d.x,d.y);lightBot.ctx.lineTo(c.x,c.y);lightBot.ctx.lineTo(a.x,a.y);lightBot.ctx.fill();lightBot.ctx.stroke()};lightBot.Box.prototype.drawSideFace=function(){lightBot.ctx.fillStyle="#e5f0f5";var a=lightBot.projection.project(this.x*50,0,this.y*50),b=lightBot.projection.project(this.x*50,this.getHeight()*50,this.y*50),d=lightBot.projection.project(this.x*
50,this.getHeight()*50,(this.y+1)*50),c=lightBot.projection.project(this.x*50,0,(this.y+1)*50);lightBot.ctx.beginPath();lightBot.ctx.moveTo(a.x,a.y);lightBot.ctx.lineTo(b.x,b.y);lightBot.ctx.lineTo(d.x,d.y);lightBot.ctx.lineTo(c.x,c.y);lightBot.ctx.lineTo(a.x,a.y);lightBot.ctx.fill();lightBot.ctx.stroke()};lightBot.Box.prototype.draw=function(){lightBot.ctx.strokeStyle="#485256";lightBot.ctx.lineWidth=0.5;this.drawTopFace();this.drawFrontFace();this.drawSideFace()};lightBot.Box.prototype.getHeight=
function(){return this.height*0.5};lightBot.Box.prototype.getEdgeLength=function(){return 50};lightBot.LightBox.prototype.step=function(){this.pulseGrowing?this.currentAnimationFrame+1>=30?this.pulseGrowing=false:this.currentAnimationFrame++:this.currentAnimationFrame<=0?this.pulseGrowing=true:this.currentAnimationFrame--};lightBot.LightBox.prototype.drawTopFace=function(){lightBot.ctx.fillStyle=this.lightOn?"#FFE545":"#0468fb";var a=lightBot.projection.project(this.x*50,this.getHeight()*50,this.y*
50),b=lightBot.projection.project((this.x+1)*50,this.getHeight()*50,this.y*50),d=lightBot.projection.project((this.x+1)*50,this.getHeight()*50,(this.y+1)*50),c=lightBot.projection.project(this.x*50,this.getHeight()*50,(this.y+1)*50);lightBot.ctx.beginPath();lightBot.ctx.moveTo(a.x,a.y);lightBot.ctx.lineTo(b.x,b.y);lightBot.ctx.lineTo(d.x,d.y);lightBot.ctx.lineTo(c.x,c.y);lightBot.ctx.lineTo(a.x,a.y);lightBot.ctx.fill();lightBot.ctx.stroke();c=(1-this.currentAnimationFrame/30)*12.5;lightBot.ctx.fillStyle=
this.lightOn?"#FEFBAF":"#4c81ff";a=lightBot.projection.project(this.x*50+c,this.getHeight()*50,this.y*50+c);b=lightBot.projection.project((this.x+1)*50-c,this.getHeight()*50,this.y*50+c);d=lightBot.projection.project((this.x+1)*50-c,this.getHeight()*50,(this.y+1)*50-c);c=lightBot.projection.project(this.x*50+c,this.getHeight()*50,(this.y+1)*50-c);lightBot.ctx.beginPath();lightBot.ctx.moveTo(a.x,a.y);lightBot.ctx.lineTo(b.x,b.y);lightBot.ctx.lineTo(d.x,d.y);lightBot.ctx.lineTo(c.x,c.y);lightBot.ctx.lineTo(a.x,
a.y);lightBot.ctx.fill()}})();(function(){lightBot.bot.animations={stand:{name:"stand",loop:false,totalFrames:1,step:10,duration:10,width:80,height:100,sX:0},walk:{name:"walk",loop:true,totalFrames:3,step:5,duration:20,width:80,height:100,sX:80},light:{name:"light",loop:true,totalFrames:2,step:3,duration:20,width:80,height:100,sX:480},jumpUp:{name:"jumpUp",loop:false,totalFrames:1,step:15,duration:15,width:80,height:100,sX:320},jumpDown:{name:"jumpDown",loop:false,totalFrames:1,step:15,duration:15,width:80,height:100,sX:400}}})();(function(){function a(a){e=a;j=g=0}function b(a,b,d){i.dX=a;i.dY=b;i.dZ=d}var d=true,c=new Image;c.src="img/sprites.png";var g=0,j=0,e=lightBot.bot.animations.stand,i={dX:0,dY:0,dZ:0};lightBot.bot.animate=function(c,f,e){d=false;switch(c.name){case lightBot.bot.instructions.WalkInstruction.instructionName:a(lightBot.bot.animations.walk);b((f.x-e.x)*lightBot.map.getMapRef()[f.x][f.y].getEdgeLength(),0,(f.y-e.y)*lightBot.map.getMapRef()[f.x][f.y].getEdgeLength());break;case lightBot.bot.instructions.JumpInstruction.instructionName:c=
(lightBot.map.getMapRef()[e.x][e.y].getHeight()-lightBot.map.getMapRef()[f.x][f.y].getHeight())*lightBot.map.getMapRef()[e.x][e.y].getEdgeLength();c>0?a(lightBot.bot.animations.jumpUp):c<0?a(lightBot.bot.animations.jumpDown):a(lightBot.bot.animations.jumpUp);b((f.x-e.x)*lightBot.map.getMapRef()[f.x][f.y].getEdgeLength(),c,(f.y-e.y)*lightBot.map.getMapRef()[f.x][f.y].getEdgeLength());break;case lightBot.bot.instructions.LightInstruction.instructionName:a(lightBot.bot.animations.light);break;case lightBot.bot.instructions.TurnLeftInstruction.instructionName:case lightBot.bot.instructions.TurnRightInstruction.instructionName:case lightBot.bot.instructions.RepeatInstruction.instructionName:break;
default:console.error('bot view animate: unknown animation "'+c.name+'"')}};lightBot.bot.step=function(){if(g>=e.duration||!lightBot.bot.isInExecutionMode())d=true,a(lightBot.bot.animations.stand),b(0,0,0);else{var c=Math.floor(g/e.step);j=e.loop?e.name==="walk"?c<e.totalFrames?c%e.totalFrames:(c+1)%(e.totalFrames-1)+1:c%e.totalFrames:Math.min(c,e.totalFrames-1);g++}};lightBot.bot.draw=function(){var a=g/e.duration*i.dX,b=g/e.duration*i.dY,d=g/e.duration*i.dZ;e.name==="jumpUp"&&(b=Math.pow(g/e.duration,
0.3)*i.dY);e.name==="jumpDown"&&(b=Math.pow(g/e.duration,4)*i.dY);a=lightBot.projection.project(this.currentPos.x*lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].getEdgeLength()+(i.dX-a),lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].getHeight()*lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].getEdgeLength()+(-i.dY+b),this.currentPos.y*lightBot.map.getMapRef()[this.currentPos.x][this.currentPos.y].getEdgeLength()+(i.dZ-d));lightBot.ctx.drawImage(c,e.sX+
j*e.width,this.direction*e.height,e.width,e.height,Math.floor(a.x-e.width/2),Math.floor(a.y-e.height),e.width,e.height)};lightBot.bot.getAnimation=function(){return e};lightBot.bot.setAnimation=a;lightBot.bot.getCurrentStep=function(){return g};lightBot.bot.getMovement=function(){return i};lightBot.bot.setMovement=b;lightBot.bot.isReadyForNextInstruction=function(){return d}})();(function(){lightBot.Projection=function(a,b,d){this.project=function(c,g,j){return{x:b+0.707*c-0.707*j,y:a-(d+0.321*c+0.891*g+0.321*j)}}}})();(function(){lightBot.medals.display=function(a){$("#levelCompleteDialog .medal").removeClass("medal-gold medal-silver medal-bronze");switch(a){case lightBot.medals.gold:$("#levelCompleteDialog .medal").addClass("medal-gold");$("#levelCompleteDialog .message").html("");break;case lightBot.medals.silver:$("#levelCompleteDialog .medal").addClass("medal-silver");$("#levelCompleteDialog .message").html("Completá el nivel con "+lightBot.map.getMedals().gold+" o menos instrucciones para recibir la medalla de oro.");
break;case lightBot.medals.bronze:$("#levelCompleteDialog .medal").addClass("medal-bronze");$("#levelCompleteDialog .message").html("Completá el nivel con "+lightBot.map.getMedals().silver+" o menos instrucciones para recibir la medalla de plata.");break;case lightBot.medals.noMedal:$("#levelCompleteDialog .message").html("Completá el nivel con "+lightBot.map.getMedals().bronze+" o menos instrucciones para recibir una medalla de bronce.");break;default:console.error('Unknown medal "'+a+'"')}$("#levelCompleteDialog .nbrOfInstructions").html(lightBot.bot.getNumberOfInstructions());
$("#levelCompleteDialog").dialog("open")}})();(function(){var a=null;lightBot.achievements.display=function(b){b&&(a=b);a.length>0?(b=a.shift(),$("#achievementDialog .message").html(b.message),$("#achievementDialog").dialog("open")):a=null}})();$(document).ready(function(){canvasView($("#gameCanvas"))});$(document).ready(function(){var a=window.History;if(a.enabled)a.Adapter.bind(window,"statechange",function(){var b=a.getState();if(b===null)lightBot.ui.showWelcomeScreen(true);else switch(b.data.page){case "welcomeScreen":lightBot.ui.showWelcomeScreen(true);break;case "helpScreen":lightBot.ui.showHelpScreen(true);break;case "achievementsScreen":lightBot.ui.showHelpScreen(true);break;case "levelSelectScreen":lightBot.ui.showLevelSelectScreen(true);break;case "gameScreen":lightBot.ui.showGameScreen(b.data.level,
true);break;default:console.error("Unknown history page: "+b.data.page)}}),lightBot.ui.History=a,lightBot.ui.showWelcomeScreen()});
